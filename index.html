<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#F3EBDD" />
  <title>Casa</title>

  <style>
    :root{
      /* Beige / neutral palette */
      --bg: #F6F0E6;
      --panel: #FFF9F0;
      --panel2: #F3EBDD;
      --border: rgba(35, 24, 16, .12);
      --text: #231810;
      --muted: rgba(35, 24, 16, .62);
      --muted2: rgba(35, 24, 16, .46);

      /* Accent: espresso */
      --accent: #2A1B12;
      --accent2: #3A261A;
      --shadow: 0 18px 45px rgba(35, 24, 16, .10);
      --radius: 18px;
      --focus: 0 0 0 4px rgba(58,38,26,.18);

      /* Lobsters */
      --lobsterOn: #2A1B12;
      --lobsterOff: rgba(42,27,18,.18);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% 0%, rgba(58,38,26,.08), transparent 55%),
        radial-gradient(900px 650px at 92% 8%, rgba(42,27,18,.06), transparent 60%),
        var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width: 1080px; margin: 0 auto; padding: 0 16px; }

    /* Top bar */
    .nav{
      position: sticky;
      top:0;
      z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(246,240,230,.78);
      border-bottom: 1px solid rgba(35,24,16,.08);
      padding-top: env(safe-area-inset-top);
    }
    .nav .wrap{
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
    }

    /* Didone-style italic serif for CASA */
    .brandWord{
      font-family: Didot, "Bodoni 72", "Bodoni MT", "Didot LT STD", "Times New Roman", serif;
      font-style: italic;
      font-weight: 700;
      letter-spacing: .2px;
      font-size: 18px;
      line-height: 1.05;
    }
    .brandSub{
      margin-top: 2px;
      font-size: 12px;
      font-weight: 800;
      color: var(--muted);
      letter-spacing: .2px;
    }

    .logoMark{
      width:42px; height:42px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,249,240,.95), rgba(243,235,221,.92));
      border: 1px solid rgba(35,24,16,.10);
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 12px 30px rgba(35,24,16,.10);
      flex: 0 0 auto;
    }

    /* Buttons */
    .btn{
      border:1px solid rgba(35,24,16,.14);
      background: rgba(255,249,240,.9);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 900;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ box-shadow: 0 10px 22px rgba(35,24,16,.08); }
    .btn:focus{ outline:none; box-shadow: var(--focus); }
    .btn.primary{
      border: 1px solid rgba(35,24,16,.18);
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#FFF9F0;
    }
    .btn.ghost{
      background: transparent;
      border:1px solid rgba(35,24,16,.12);
      color: var(--text);
    }
    .pill{
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid rgba(35,24,16,.12);
      background: rgba(255,249,240,.85);
      font-weight: 900;
      font-size: 12px;
      color: var(--text);
      max-width: 50vw;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .navRight{ display:flex; align-items:center; gap:10px; }

    /* Dropdown menu */
    .menuWrap{ position:relative; }
    .menu{
      position:absolute;
      right:0;
      top: calc(100% + 10px);
      width: min(360px, 92vw);
      background: rgba(255,249,240,.98);
      border: 1px solid rgba(35,24,16,.12);
      border-radius: 16px;
      box-shadow: 0 26px 70px rgba(35,24,16,.18);
      padding: 10px;
      display:none;
      z-index:999;
    }
    .menu.open{ display:block; }
    .menu .item{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 900;
      color: var(--text);
      border: 1px solid transparent;
    }
    .menu .item:hover{
      background: rgba(243,235,221,.75);
      border-color: rgba(35,24,16,.08);
    }
    .menu .mutedItem{
      padding: 8px 10px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
      line-height:1.35;
    }
    .menu .hr{
      height:1px;
      background: rgba(35,24,16,.10);
      margin: 8px 0;
    }
    .menu .guidelines{
      padding: 10px;
      border-radius: 14px;
      border: 1px dashed rgba(35,24,16,.18);
      background: rgba(243,235,221,.55);
    }
    .menu ul{ margin:10px 0 0 18px; padding:0; }
    .menu li{ margin:6px 0; font-weight:800; color: rgba(35,24,16,.78); }

    /* Cards / panels */
    .card{
      background: rgba(255,249,240,.92);
      border:1px solid rgba(35,24,16,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{ padding: 16px 16px 10px; }
    .bd{ padding: 10px 16px 16px; }

    .tiny{ font-size: 12.5px; color: var(--muted2); font-weight: 800; }
    .muted{ color: var(--muted); }

    /* Landing */
    .hero{
      padding: 26px 0 18px;
    }
    .heroTitle{
      margin: 0 0 12px;
      font-size: 44px;
      line-height: 1.03;
      letter-spacing: -1px;
      font-weight: 1000;
    }
    .heroBlurb{
      margin: 0 0 18px;
      color: var(--muted);
      max-width: 82ch;
      font-weight: 750;
    }

    .bubbleRow{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin-top: 14px;
    }
    .bubble{
      border:1px solid rgba(35,24,16,.14);
      background: rgba(255,249,240,.92);
      padding: 14px 16px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      box-shadow: 0 12px 30px rgba(35,24,16,.07);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .bubble:hover{ box-shadow: 0 18px 38px rgba(35,24,16,.10); }
    .bubble:focus{ outline:none; box-shadow: var(--focus); }
    .bubbleBig{
      padding: 16px 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border:1px solid rgba(35,24,16,.20);
      color: #FFF9F0;
    }
    .bubbleTitle{
      font-weight: 1000;
      line-height:1.1;
    }
    .bubbleSub{
      font-size: 12.5px;
      font-weight: 850;
      opacity: .85;
      margin-top: 2px;
    }

    .infoGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-top: 16px;
    }
    .infoCard{
      padding: 16px;
      border-radius: 18px;
      border:1px solid rgba(35,24,16,.12);
      background: rgba(243,235,221,.55);
    }
    .infoCard .kicker{
      font-weight: 1000;
      font-size: 12px;
      letter-spacing: .7px;
      text-transform: uppercase;
      color: rgba(35,24,16,.75);
      margin-bottom: 8px;
    }
    .infoCard .big{
      font-weight: 1000;
      font-size: 16px;
      color: var(--text);
      margin-bottom: 6px;
      line-height:1.25;
    }
    .infoCard .small{
      font-weight: 800;
      font-size: 13px;
      color: rgba(35,24,16,.72);
      line-height:1.35;
    }

    /* Lookup */
    .lookupTop{
      padding: 20px 0 10px;
    }
    .lookupTitle{
      margin:0 0 8px;
      font-size: 30px;
      font-weight: 1000;
      letter-spacing: -.6px;
    }
    .searchBubbles{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .searchBubble{
      border:1px solid rgba(35,24,16,.12);
      background: rgba(255,249,240,.92);
      border-radius: 22px;
      padding: 14px;
      box-shadow: 0 10px 24px rgba(35,24,16,.06);
    }
    .searchBubble .label{
      font-weight:1000;
      margin-bottom: 8px;
    }
    .searchBubble input{
      width:100%;
      border:none;
      outline:none;
      background: rgba(243,235,221,.45);
      border:1px solid rgba(35,24,16,.10);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 14px;
      color: var(--text);
      font-weight: 850;
    }
    .searchBubble input:focus{ box-shadow: var(--focus); }

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 16px;
      margin: 14px 0 40px;
    }

    /* Result cards */
    .rowCard{
      display:flex;
      gap:12px;
      align-items:stretch;
      padding: 14px;
      border:1px solid rgba(35,24,16,.10);
      border-radius: 16px;
      background: rgba(255,249,240,.96);
      box-shadow: 0 10px 22px rgba(35,24,16,.06);
      cursor:pointer;
      margin-top: 12px;
      transition: transform .08s ease;
    }
    .rowCard:hover{ transform: translateY(-1px); }
    .rowMain{ flex:1; min-width:0; }
    .rowTitle{
      font-size: 16px;
      font-weight: 1000;
      margin: 0 0 6px;
      color: var(--text);
      line-height:1.2;
    }
    .rowSub{
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
      margin-bottom: 8px;
    }
    .tagRow{ display:flex; flex-wrap:wrap; gap:8px; }
    .tag{
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      border:1px solid rgba(35,24,16,.10);
      background: rgba(243,235,221,.65);
      color: rgba(35,24,16,.82);
    }

    /* Lobster stars */
    .lobsterRow{
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom: 6px;
    }
    .lobsterStars{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .lobster{
      width: 18px;
      height: 18px;
      display:block;
    }
    .scoreText{
      font-weight: 1000;
      font-size: 13px;
      color: var(--text);
    }

    /* Profile */
    #profileView{ display:none; padding: 12px 0 40px; }
    .profileTop{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
      width:100%;
    }
    h2{
      margin:0 0 6px;
      font-size: 28px;
      letter-spacing: -.5px;
      color: var(--text);
    }
    .profileActions{ display:flex; gap:10px; flex-wrap:wrap; }
    .statsRow{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 16px;
      align-items:start;
    }
    .bigScore{
      border:1px solid rgba(35,24,16,.12);
      border-radius: 18px;
      background: rgba(255,249,240,.96);
      padding: 14px;
      box-shadow: 0 10px 22px rgba(35,24,16,.06);
    }
    .bigScore .num{
      font-size: 40px;
      font-weight: 1000;
      line-height:1;
      color: var(--text);
    }
    .bigScore .sub{
      margin-top:8px;
      color: var(--muted);
      font-weight: 900;
      font-size: 13px;
    }
    .barGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .bar{
      border:1px solid rgba(35,24,16,.12);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,249,240,.96);
      box-shadow: 0 10px 22px rgba(35,24,16,.06);
    }
    .barTop{
      display:flex; justify-content:space-between; align-items:center;
      font-weight: 1000;
      font-size: 13px;
      color: rgba(35,24,16,.82);
      margin-bottom: 8px;
    }
    .track{
      height: 10px;
      border-radius: 999px;
      background: rgba(35,24,16,.08);
      overflow:hidden;
      border:1px solid rgba(35,24,16,.08);
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 999px;
    }

    /* Owner response area */
    .ownerResp{
      margin-top:12px;
      padding:12px;
      border:1px solid rgba(35,24,16,.12);
      background: rgba(243,235,221,.55);
      border-radius: 14px;
    }
    .ownerRespTitle{
      font-weight: 1000;
      font-size: 12px;
      color: rgba(35,24,16,.85);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: .6px;
    }
    .ownerRespDate{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      font-weight: 800;
    }

    /* Modal */
    #modalBackdrop{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(35, 24, 16, .45);
      z-index: 999;
      padding: 18px;
      padding-top: calc(18px + env(safe-area-inset-top));
      padding-bottom: calc(18px + env(safe-area-inset-bottom));
    }
    .modal{
      max-width: 620px;
      margin: 0 auto;
      background: rgba(255,249,240,.98);
      border-radius: 20px;
      overflow:hidden;
      border:1px solid rgba(35,24,16,.12);
      box-shadow: 0 30px 80px rgba(0,0,0,.20);
    }
    .modalHd{
      padding: 14px 16px;
      border-bottom:1px solid rgba(35,24,16,.10);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .modalBd{ padding: 14px 16px; }
    .modalFt{
      padding: 12px 16px;
      border-top:1px solid rgba(35,24,16,.10);
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }

    .field label{ font-size: 13px; font-weight: 1000; color: rgba(35,24,16,.82); }
    .field input, .field textarea, .field select{
      margin-top:6px;
      width:100%;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(35,24,16,.12);
      outline:none;
      font-size: 14px;
      background: rgba(255,249,240,.95);
      color: var(--text);
      font-weight: 850;
    }
    .field input:focus, .field textarea:focus, .field select:focus{ box-shadow: var(--focus); border-color: rgba(35,24,16,.20); }
    textarea{ resize: vertical; min-height: 90px; }

    /* Mobile */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .heroTitle{ font-size: 36px; }
      .infoGrid{ grid-template-columns: 1fr; }
      .statsRow{ grid-template-columns: 1fr; }
      .barGrid{ grid-template-columns: 1fr; }
      .searchBubbles{ grid-template-columns: 1fr; }
    }
    @media (max-width: 520px){
      .nav .wrap{ height:60px; }
      .pill{ display:none; }
      .btn{ padding: 10px 12px; }
      .rowCard{ padding: 12px; }
    }
  </style>
</head>

<body>
  <div class="nav">
    <div class="wrap">
      <a class="brand" href="#" onclick="goLanding(); return false;">
        <div class="logoMark" aria-hidden="true" title="Casa">
          <!-- Logo inspired by the attached curved-stacked line mark -->
          <svg width="30" height="30" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <!-- 6 stacked curved strokes -->
            <path d="M10 16 C24 6, 40 6, 54 16" stroke="#1E140D" stroke-width="3.2" stroke-linecap="round" opacity="1"/>
            <path d="M12 22 C25 13, 39 13, 52 22" stroke="#1E140D" stroke-width="3.0" stroke-linecap="round" opacity=".92"/>
            <path d="M14 28 C26 20, 38 20, 50 28" stroke="#1E140D" stroke-width="2.8" stroke-linecap="round" opacity=".84"/>
            <path d="M16 34 C27 28, 37 28, 48 34" stroke="#1E140D" stroke-width="2.6" stroke-linecap="round" opacity=".76"/>
            <path d="M18 40 C28 36, 36 36, 46 40" stroke="#1E140D" stroke-width="2.4" stroke-linecap="round" opacity=".68"/>
            <path d="M20 46 C29 44, 35 44, 44 46" stroke="#1E140D" stroke-width="2.2" stroke-linecap="round" opacity=".60"/>
          </svg>
        </div>
        <div>
          <div class="brandWord">Casa</div>
          <div class="brandSub">renting, but smarter</div>
        </div>
      </a>

      <div class="navRight">
        <span id="userPill" class="pill" style="display:none;"></span>

        <div class="menuWrap">
          <button class="btn" id="menuBtn" onclick="toggleMenu()">☰ Menu</button>
          <div class="menu" id="menu">
            <div class="mutedItem" id="modeNote">Demo mode (GitHub Pages)</div>
            <div class="hr"></div>

            <div class="item" onclick="goLookup()">
              <span>Landlord lookup</span><span>→</span>
            </div>
            <div class="item" onclick="openModal('addLandlord')">
              <span>Add landlord</span><span>＋</span>
            </div>
            <div class="item" onclick="openModal('addReview')">
              <span>Write review</span><span>✎</span>
            </div>

            <div class="hr"></div>

            <div class="item" id="authItem" onclick="openModal('auth')">
              <span>Log in</span><span>→</span>
            </div>
            <div class="item" id="logoutItem" style="display:none;" onclick="logout()">
              <span>Log out</span><span>⎋</span>
            </div>

            <div class="hr"></div>

            <div class="mutedItem" style="padding-bottom:6px;">Posting guidelines</div>
            <div class="guidelines">
              <div class="tiny">Keep it factual. Avoid personal info. No threats/harassment.</div>
              <ul>
                <li>Use dates (“work order 5/3, fixed 5/20”).</li>
                <li>No phone numbers/emails/SSNs.</li>
                <li>No threats, harassment, or discriminatory content.</li>
                <li>Keep addresses general (street + neighborhood is safest).</li>
              </ul>
            </div>

            <div class="hr"></div>

            <div class="item" onclick="resetAllData()">
              <span>Reset local data</span><span>⚠︎</span>
            </div>
          </div>
        </div>

        <button class="btn primary" onclick="goLookup()">Lookup</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- LANDING / INFOGRAPHIC VIEW -->
    <section id="landingView">
      <div class="hero">
        <div class="heroTitle">Renting shouldn’t be a gamble.</div>
        <div class="heroBlurb">
          Casa is a calm, simple place to look up landlords and leave factual reviews.
          No drama — just signal.
        </div>

        <div class="bubbleRow">
          <button class="bubble bubbleBig" onclick="goLookup()" style="border:none;">
            <div>
              <div class="bubbleTitle">Start a landlord lookup</div>
              <div class="bubbleSub">Search by landlord or address</div>
            </div>
            <div style="margin-left:6px; font-weight:1000;">→</div>
          </button>

          <button class="bubble" onclick="openModal('addLandlord')">
            <div>
              <div class="bubbleTitle">Add a landlord</div>
              <div class="bubbleSub">Create a listing in seconds</div>
            </div>
            <div style="margin-left:6px; font-weight:1000;">＋</div>
          </button>

          <button class="bubble" onclick="openModal('auth')">
            <div>
              <div class="bubbleTitle">Log in</div>
              <div class="bubbleSub">Save + post reviews</div>
            </div>
            <div style="margin-left:6px; font-weight:1000;">→</div>
          </button>
        </div>

        <div class="infoGrid">
          <div class="infoCard">
            <div class="kicker">1 • Look up</div>
            <div class="big">Search by landlord or address</div>
            <div class="small">Two clean search bubbles. No clutter. Fast results.</div>
          </div>
          <div class="infoCard">
            <div class="kicker">2 • Review</div>
            <div class="big">Lobster ratings (1–5)</div>
            <div class="small">Use lobsters as “stars” — clean signal, easy to read.</div>
          </div>
          <div class="infoCard">
            <div class="kicker">3 • Improve</div>
            <div class="big">Better renting decisions</div>
            <div class="small">Factual notes, timelines, and patterns — not rants.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- LOOKUP VIEW -->
    <section id="lookupView" style="display:none;">
      <div class="lookupTop">
        <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;">
          <div>
            <div class="lookupTitle">Landlord lookup</div>
            <div class="muted" style="font-weight:800;">Search landlords and open a profile to view reviews.</div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" onclick="goLanding()">← Home</button>
            <button class="btn primary" onclick="openModal('addLandlord')">Add landlord</button>
          </div>
        </div>

        <div class="searchBubbles">
          <div class="searchBubble">
            <div class="label">Search by landlord</div>
            <input id="searchLandlord" placeholder="e.g., Northside Management" oninput="renderLookup()" />
            <div class="tiny" style="margin-top:8px;">Matches landlord name + neighborhood + city.</div>
          </div>
          <div class="searchBubble">
            <div class="label">Search by address</div>
            <input id="searchAddress" placeholder="e.g., 123 Main St, Williamsburg" oninput="renderLookup()" />
            <div class="tiny" style="margin-top:8px;">Matches listing address field + neighborhood + city.</div>
          </div>
        </div>
      </div>

      <div class="grid">
        <div>
          <div class="card">
            <div class="hd" style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start;">
              <div>
                <div style="font-weight:1000;">Results</div>
                <div class="tiny">Tap a landlord to view details.</div>
              </div>
              <div class="tiny" id="resultCount"></div>
            </div>
            <div class="bd" id="landlordList"></div>
          </div>
        </div>

        <aside class="card">
          <div class="hd">
            <div style="font-weight:1000;">Quick actions</div>
            <div class="tiny muted">Keep the homepage clean — do actions here.</div>
          </div>
          <div class="bd" style="display:flex; flex-direction:column; gap:10px;">
            <button class="btn primary" style="justify-content:center;" onclick="openModal('addReview')">Write review</button>
            <button class="btn" style="justify-content:center;" onclick="openModal('addLandlord')">Add landlord</button>
            <button class="btn ghost" style="justify-content:center;" onclick="openModal('auth')">Log in</button>
          </div>
        </aside>
      </div>
    </section>

    <!-- PROFILE VIEW -->
    <section id="profileView">
      <div class="card">
        <div class="hd">
          <div class="profileTop">
            <div>
              <h2 id="profileName">—</h2>
              <div class="muted" id="profileSub" style="font-weight:800;">—</div>
            </div>
            <div class="profileActions">
              <button class="btn" onclick="goLookup()">← Back</button>
              <button class="btn primary" onclick="openModal('addReview')">Write review</button>
            </div>
          </div>
        </div>

        <div class="bd">
          <div class="statsRow">
            <div class="bigScore">
              <div class="lobsterRow">
                <div class="lobsterStars" id="profileLobsters"></div>
                <div class="scoreText"><span id="profileOverall">—</span></div>
              </div>
              <div class="sub"><span id="profileReviewCount">0</span> reviews • Overall</div>

              <div style="margin-top:12px;">
                <div class="tiny muted">Listing address (optional)</div>
                <div style="font-weight:900; margin-top:4px;" id="profileAddress">—</div>
              </div>
            </div>

            <div class="barGrid" id="profileBars"></div>
          </div>

          <div style="margin-top:16px;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
              <div style="font-weight:1000;">Reviews</div>
              <div class="tiny muted" id="profileReviewHint"></div>
            </div>
            <div id="profileReviews" style="margin-top:10px;"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- MODAL -->
  <div id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHd">
        <div style="font-weight:1000;" id="modalTitle">—</div>
        <button class="btn" onclick="closeModal()">✕</button>
      </div>
      <div class="modalBd" id="modalBody"></div>
      <div class="modalFt">
        <button class="btn" onclick="closeModal()">Cancel</button>
        <button class="btn primary" id="modalSubmitBtn" onclick="handleModalSubmit()">Save</button>
      </div>
    </div>
  </div>

<script>
  /***********************
   * CASA (GitHub Pages friendly)
   * - Frontend only
   * - Demo login in localStorage
   * - Data saved in localStorage
   ***********************/

  const LS_DB = "casa_db_v2";
  const LS_AUTH = "casa_auth_v2";

  let db = { version: 2, landlords: [] };
  let currentUser = null; // { email, role }

  const state = {
    view: "landing",
    selectedLandlordId: null
  };

  let currentModal = { type: null };

  /* ===== Lobster icon (cleaner) ===== */
  function lobsterSVG(on=true){
    const stroke = on ? "var(--lobsterOn)" : "var(--lobsterOff)";
    // Cleaner, symmetric lobster icon, designed to read like a "star"
    return `
      <svg class="lobster" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <!-- claws -->
        <path d="M18 18c-7-6-13-2-13 4 0 5 5 8 10 7" stroke="${stroke}" stroke-width="3.6" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M46 18c7-6 13-2 13 4 0 5-5 8-10 7" stroke="${stroke}" stroke-width="3.6" stroke-linecap="round" stroke-linejoin="round"/>
        <!-- arms -->
        <path d="M22 26c-6-4-11-2-14 2" stroke="${stroke}" stroke-width="3.4" stroke-linecap="round"/>
        <path d="M42 26c6-4 11-2 14 2" stroke="${stroke}" stroke-width="3.4" stroke-linecap="round"/>
        <!-- body -->
        <path d="M32 16c-7 0-13 6-13 15 0 7 4 12 9 15v8c0 3 2 5 4 5s4-2 4-5v-8c5-3 9-8 9-15 0-9-6-15-13-15Z"
              stroke="${stroke}" stroke-width="3.6" stroke-linejoin="round"/>
        <!-- segments -->
        <path d="M26 38h12" stroke="${stroke}" stroke-width="3.4" stroke-linecap="round"/>
        <path d="M27 46h10" stroke="${stroke}" stroke-width="3.2" stroke-linecap="round" opacity=".95"/>
      </svg>
    `;
  }

  function renderLobsterStars(score){
    if(score === null || score === undefined) return `<span class="tiny muted">No reviews</span>`;
    const filled = Math.round(score);
    let out = "";
    for(let i=1;i<=5;i++) out += lobsterSVG(i <= filled);
    return out;
  }

  /* ===== Utils ===== */
  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function uuid(){
    if(crypto?.randomUUID) return crypto.randomUUID();
    return "id-" + Math.random().toString(16).slice(2) + Date.now().toString(16);
  }
  function avg(nums){
    if(!nums.length) return null;
    return nums.reduce((a,b)=>a+b,0) / nums.length;
  }
  function fmtScore(x){
    if(x === null || x === undefined) return "—";
    return (Math.round(x*10)/10).toFixed(1);
  }
  function landlordStats(l){
    const rs = l.reviews || [];
    const keys = ["overall","repairs","responsiveness","deposits","conditions","communication"];
    const out = { count: rs.length };
    for(const k of keys){
      out[k] = avg(rs.map(r => (r.ratings && r.ratings[k]) ? Number(r.ratings[k]) : null).filter(v => v !== null));
    }
    return out;
  }
  function tagsFromStats(stats){
    const tags = [];
    if(!stats.count) return ["No reviews yet"];
    if(stats.repairs >= 4.2) tags.push("Fast repairs");
    if(stats.responsiveness >= 4.2) tags.push("Responsive");
    if(stats.communication >= 4.0) tags.push("Clear communication");
    if(stats.conditions <= 2.8) tags.push("Condition issues");
    if(stats.deposits <= 2.5) tags.push("Deposit issues");
    if(!tags.length) tags.push("Mixed experiences");
    return tags.slice(0,3);
  }

  function normalize(s){
    return String(s || "").toLowerCase().trim();
  }

  function matchesLandlordQuery(l, q){
    if(!q) return true;
    const hay = normalize([l.name, l.neighborhood, l.city].filter(Boolean).join(" "));
    return hay.includes(normalize(q));
  }

  function matchesAddressQuery(l, q){
    if(!q) return true;
    const hay = normalize([l.address, l.neighborhood, l.city].filter(Boolean).join(" "));
    return hay.includes(normalize(q));
  }

  /* ===== Storage ===== */
  function readDB(){
    try{
      const raw = localStorage.getItem(LS_DB);
      if(!raw) return { version: 2, landlords: [] };
      const parsed = JSON.parse(raw);
      parsed.version = 2;
      parsed.landlords = parsed.landlords || [];
      return parsed;
    }catch{
      return { version: 2, landlords: [] };
    }
  }
  function writeDB(){
    localStorage.setItem(LS_DB, JSON.stringify(db));
  }

  function readAuth(){
    try{
      const raw = localStorage.getItem(LS_AUTH);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch{
      return null;
    }
  }
  function writeAuth(user){
    localStorage.setItem(LS_AUTH, JSON.stringify(user));
  }

  /* ===== Menu ===== */
  function toggleMenu(){
    document.getElementById("menu").classList.toggle("open");
  }
  function closeMenu(){
    document.getElementById("menu").classList.remove("open");
  }

  function renderAuthUI(){
    const pill = document.getElementById("userPill");
    const authItem = document.getElementById("authItem");
    const logoutItem = document.getElementById("logoutItem");

    if(!currentUser){
      pill.style.display = "none";
      authItem.style.display = "flex";
      logoutItem.style.display = "none";
      return;
    }

    pill.style.display = "inline-flex";
    pill.textContent = `${currentUser.email} • ${currentUser.role}`;
    authItem.style.display = "none";
    logoutItem.style.display = "flex";
  }

  /* ===== Navigation ===== */
  function show(view){
    state.view = view;
    document.getElementById("landingView").style.display = (view === "landing") ? "block" : "none";
    document.getElementById("lookupView").style.display   = (view === "lookup") ? "block" : "none";
    document.getElementById("profileView").style.display  = (view === "profile") ? "block" : "none";
  }
  function goLanding(){
    closeMenu();
    state.selectedLandlordId = null;
    show("landing");
  }
  function goLookup(){
    closeMenu();
    state.selectedLandlordId = null;
    show("lookup");
    renderLookup();
    setTimeout(()=> {
      const el = document.getElementById("searchLandlord");
      if(el) el.focus();
    }, 50);
  }

  /* ===== Rendering ===== */
  function renderLookup(){
    const qLandlord = (document.getElementById("searchLandlord")?.value || "").trim();
    const qAddress  = (document.getElementById("searchAddress")?.value || "").trim();

    const list = document.getElementById("landlordList");
    const resultCount = document.getElementById("resultCount");

    const landlords = (db.landlords || [])
      .filter(l => matchesLandlordQuery(l, qLandlord))
      .filter(l => matchesAddressQuery(l, qAddress))
      .map(l => ({ l, stats: landlordStats(l) }));

    // Sort by overall desc, then count desc
    landlords.sort((a,b)=>{
      const ao = a.stats.overall ?? -1;
      const bo = b.stats.overall ?? -1;
      if(bo !== ao) return bo - ao;
      return (b.stats.count || 0) - (a.stats.count || 0);
    });

    resultCount.textContent = `${landlords.length} shown`;
    list.innerHTML = "";

    landlords.forEach(({l, stats}) => {
      const card = document.createElement("div");
      card.className = "rowCard";
      card.onclick = () => openProfile(l.id);

      const location = [l.neighborhood, l.city].filter(Boolean).join(" • ") || "—";
      const address = l.address ? ` • ${l.address}` : "";
      const tags = tagsFromStats(stats);

      card.innerHTML = `
        <div class="rowMain">
          <div class="rowTitle">${escapeHtml(l.name || "—")}</div>
          <div class="lobsterRow">
            <div class="lobsterStars">${renderLobsterStars(stats.overall)}</div>
            <div class="scoreText">${fmtScore(stats.overall)}</div>
          </div>
          <div class="rowSub">${escapeHtml(location)}${escapeHtml(address)} • ${stats.count} review${stats.count===1?"":"s"}</div>
          <div class="tagRow">
            ${tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
          </div>
        </div>
      `;
      list.appendChild(card);
    });
  }

  function openProfile(id){
    closeMenu();
    state.selectedLandlordId = id;
    show("profile");

    const l = db.landlords.find(x => x.id === id);
    if(!l){ alert("Landlord not found."); goLookup(); return; }

    const stats = landlordStats(l);

    document.getElementById("profileName").textContent = l.name || "—";
    document.getElementById("profileSub").textContent = [l.neighborhood, l.city].filter(Boolean).join(" • ") || "—";
    document.getElementById("profileAddress").textContent = l.address || "—";

    document.getElementById("profileOverall").textContent = fmtScore(stats.overall);
    document.getElementById("profileReviewCount").textContent = stats.count;
    document.getElementById("profileLobsters").innerHTML = renderLobsterStars(stats.overall);

    const barKeys = [
      ["repairs","Repairs"],
      ["responsiveness","Responsiveness"],
      ["deposits","Deposits"],
      ["conditions","Conditions"],
      ["communication","Communication"]
    ];
    document.getElementById("profileBars").innerHTML = barKeys.map(([k,label]) => {
      const v = stats[k];
      const pct = (v === null) ? 0 : Math.max(0, Math.min(100, (v/5)*100));
      return `
        <div class="bar">
          <div class="barTop"><span>${label}</span><span>${fmtScore(v)}</span></div>
          <div class="track"><div class="fill" style="width:${pct}%;"></div></div>
        </div>
      `;
    }).join("");

    const reviewHint = document.getElementById("profileReviewHint");
    reviewHint.textContent = stats.count ? "" : "No reviews yet. Be the first.";

    const reviewBox = document.getElementById("profileReviews");
    reviewBox.innerHTML = "";

    const reviews = (l.reviews || []).slice().reverse();
    reviews.forEach(r => {
      const d = document.createElement("div");
      d.className = "rowCard";

      const createdRaw = r.createdAt || "";
      const created = createdRaw ? new Date(createdRaw).toLocaleDateString() : "";

      d.innerHTML = `
        <div class="rowMain">
          <div class="rowTitle">${escapeHtml(r.title || "Review")}</div>
          <div class="lobsterRow" style="margin-top:-2px;">
            <div class="lobsterStars">${renderLobsterStars(r.ratings?.overall ?? null)}</div>
            <div class="scoreText">${fmtScore(r.ratings?.overall ?? null)}</div>
            <div class="tiny muted" style="margin-left:auto;">${escapeHtml(created)}</div>
          </div>
          <div style="font-weight:800; color:rgba(35,24,16,.78); white-space:pre-wrap; margin-top:6px;">
            ${escapeHtml(r.text || "")}
          </div>
        </div>
      `;
      reviewBox.appendChild(d);
    });
  }

  /* ===== Modals ===== */
  function openModal(type){
    closeMenu();
    currentModal.type = type;

    const title = document.getElementById("modalTitle");
    const body = document.getElementById("modalBody");
    const submitBtn = document.getElementById("modalSubmitBtn");
    submitBtn.style.display = "inline-flex";

    if(type === "auth"){
      title.textContent = "Log in";
      body.innerHTML = `
        <div class="field">
          <label>Email</label>
          <input id="m_auth_email" placeholder="you@email.com" />
        </div>
        <div class="field" style="margin-top:10px;">
          <label>Password</label>
          <input id="m_auth_pw" type="password" placeholder="••••••••" />
        </div>
        <div class="field" style="margin-top:10px;">
          <label>I am a…</label>
          <select id="m_auth_role">
            <option value="tenant">Tenant</option>
            <option value="landlord">Landlord</option>
          </select>
        </div>
        <div class="tiny muted" style="margin-top:10px;">
          Demo login: this is stored only on your device (localStorage).
        </div>
      `;
    }

    if(type === "addLandlord"){
      title.textContent = "Add a landlord";
      body.innerHTML = `
        <div class="field">
          <label>Landlord / company name</label>
          <input id="m_landlord_name" placeholder="e.g., Northside Property Management" />
        </div>
        <div class="field" style="margin-top:10px;">
          <label>Listing address (optional)</label>
          <input id="m_landlord_address" placeholder="e.g., 123 Main St" />
        </div>
        <div class="field" style="margin-top:10px;">
          <label>Neighborhood (optional)</label>
          <input id="m_landlord_neighborhood" placeholder="e.g., Williamsburg" />
        </div>
        <div class="field" style="margin-top:10px;">
          <label>City (optional)</label>
          <input id="m_landlord_city" placeholder="e.g., New York, NY" />
        </div>
        <div class="tiny muted" style="margin-top:10px;">
          Tip: If you have an address, add it — it makes the “Search by address” bubble actually useful.
        </div>
      `;
    }

    if(type === "addReview"){
      title.textContent = "Write a review";
      if(!currentUser){
        body.innerHTML = `<div class="tiny muted">Please log in first (Menu → Log in).</div>`;
        submitBtn.style.display = "none";
      } else if(!state.selectedLandlordId){
        body.innerHTML = `<div class="tiny muted">Open a landlord profile first, then write a review.</div>`;
        submitBtn.style.display = "none";
      }else{
        body.innerHTML = `
          <div class="field">
            <label>Title (optional)</label>
            <input id="m_review_title" placeholder="e.g., Great communication" />
          </div>
          <div class="field" style="margin-top:10px;">
            <label>Your review</label>
            <textarea id="m_review_text" rows="5" placeholder="Keep it factual…"></textarea>
          </div>
          <div class="field" style="margin-top:10px;">
            <label>Overall (1–5)</label>
            <select id="m_overall">${[1,2,3,4,5].map(v=>`<option>${v}</option>`).join("")}</select>
          </div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:10px;">
            ${ratingField("Repairs","m_repairs")}
            ${ratingField("Responsiveness","m_responsiveness")}
            ${ratingField("Deposits","m_deposits")}
            ${ratingField("Conditions","m_conditions")}
            ${ratingField("Communication","m_communication")}
          </div>
        `;
      }
    }

    document.getElementById("modalBackdrop").style.display = "block";
    setTimeout(()=>{
      const first = body.querySelector("input,select,textarea");
      if(first) first.focus();
    }, 30);
  }

  function ratingField(label, id, def=5){
    return `
      <div class="field">
        <label>${label} (1–5)</label>
        <select id="${id}">
          ${[1,2,3,4,5].map(v => `<option ${v===def ? "selected":""}>${v}</option>`).join("")}
        </select>
      </div>
    `;
  }

  function closeModal(){
    document.getElementById("modalBackdrop").style.display = "none";
    document.getElementById("modalSubmitBtn").style.display = "inline-flex";
    currentModal.type = null;
  }

  function handleModalSubmit(){
    const t = currentModal.type;

    if(t === "auth"){
      const email = (document.getElementById("m_auth_email").value || "").trim();
      const pw = (document.getElementById("m_auth_pw").value || "").trim();
      const role = document.getElementById("m_auth_role").value;

      if(!email || !pw) return alert("Enter email + password.");

      // Demo auth: just stores it
      currentUser = { email, role };
      writeAuth(currentUser);
      renderAuthUI();
      closeModal();
      alert("Logged in.");
      return;
    }

    if(t === "addLandlord"){
      const name = (document.getElementById("m_landlord_name").value || "").trim();
      const address = (document.getElementById("m_landlord_address").value || "").trim();
      const neighborhood = (document.getElementById("m_landlord_neighborhood").value || "").trim();
      const city = (document.getElementById("m_landlord_city").value || "").trim();
      if(name.length < 2) return alert("Please enter a landlord name.");

      db.landlords.unshift({
        id: uuid(),
        name,
        address: address || null,
        neighborhood: neighborhood || null,
        city: city || null,
        createdAt: new Date().toISOString(),
        reviews: []
      });

      writeDB();
      closeModal();
      goLookup();
      openProfile(db.landlords[0].id);
      return;
    }

    if(t === "addReview"){
      const l = db.landlords.find(x => x.id === state.selectedLandlordId);
      if(!l) return alert("Landlord not found.");

      const title = (document.getElementById("m_review_title").value || "").trim();
      const text = (document.getElementById("m_review_text").value || "").trim();
      if(text.length < 10) return alert("Please write a bit more detail (10+ chars).");

      const ratings = {
        overall: Number(document.getElementById("m_overall").value),
        repairs: Number(document.getElementById("m_repairs").value),
        responsiveness: Number(document.getElementById("m_responsiveness").value),
        deposits: Number(document.getElementById("m_deposits").value),
        conditions: Number(document.getElementById("m_conditions").value),
        communication: Number(document.getElementById("m_communication").value),
      };

      l.reviews = l.reviews || [];
      l.reviews.push({
        id: uuid(),
        title,
        text,
        ratings,
        authorEmail: currentUser?.email || null,
        createdAt: new Date().toISOString()
      });

      writeDB();
      closeModal();
      openProfile(l.id);
      return;
    }
  }

  function logout(){
    currentUser = null;
    localStorage.removeItem(LS_AUTH);
    renderAuthUI();
    alert("Logged out.");
  }

  function resetAllData(){
    if(!confirm("This resets Casa data on this device. Continue?")) return;
    db = { version: 2, landlords: [] };
    writeDB();
    goLanding();
  }

  /* ===== Global events ===== */
  document.getElementById("modalBackdrop").addEventListener("click", (e)=>{
    if(e.target.id === "modalBackdrop") closeModal();
  });
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") {
      closeModal();
      closeMenu();
    }
  });
  document.addEventListener("click", (e)=>{
    const menu = document.getElementById("menu");
    const btn = document.getElementById("menuBtn");
    if(menu.classList.contains("open")){
      if(!menu.contains(e.target) && !btn.contains(e.target)){
        closeMenu();
      }
    }
  });

  /* ===== Init ===== */
  (function init(){
    db = readDB();
    currentUser = readAuth();
    renderAuthUI();

    // Safety: if no landlords exist, seed 1 sample so your page isn't empty
    if(!db.landlords.length){
      db.landlords.push({
        id: uuid(),
        name: "Sample Property Group",
        address: "123 Main St",
        neighborhood: "Williamsburg",
        city: "New York, NY",
        createdAt: new Date().toISOString(),
        reviews: [{
          id: uuid(),
          title: "Fast repairs, okay deposit",
          text: "Work order submitted 5/3, fixed 5/6. Deposit return took 30 days.",
          ratings: { overall: 4, repairs: 5, responsiveness: 4, deposits: 3, conditions: 4, communication: 4 },
          authorEmail: null,
          createdAt: new Date().toISOString()
        }]
      });
      writeDB();
    }

    show("landing");
  })();
</script>
</body>
</html>
